<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Java Resources PDF Download | Core Java, Spring, Microservices, SQL</title>
  <meta name="description" content="Download free Java PDF resources: Core Java, Spring & Spring Boot, Microservices, SQL, JUnit, Maven/Git/Gradle, Streams & Coding. Mobile responsive, ad-supported downloads.">
  <meta name="keywords" content="Java PDF, Core Java notes, Spring Boot PDF, Microservices design patterns PDF, SQL PDF, JUnit Mockito PDF, Maven Git Gradle PDF, Java Streams coding questions">
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
  <meta name="author" content="BCVWorld">
  <link rel="canonical" href="https://bcvworld.com/html/javaresource.html">
  <meta property="og:title" content="Java Resources PDF Download | Core Java, Spring, Microservices, SQL">
  <meta property="og:description" content="Comprehensive Java PDFs for learning and interviews. Clean UI, mobile responsive, and secure downloads after ad view.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://bcvworld.com/html/javaresource.html">
  <meta property="og:site_name" content="BCVWorld">
  <meta property="og:image" content="https://bcvworld.com/assets/images/bcvworld-og.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:locale" content="en_IN">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Java Resources PDF Download | Core Java, Spring, Microservices, SQL">
  <meta name="twitter:description" content="Free Java study PDFs with ad-supported downloads. Optimized for mobile.">
  <meta name="twitter:image" content="https://bcvworld.com/assets/images/twitter-image.webp">



  <!-- AdSense script -->
  <script async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6284022198338659"
    crossorigin="anonymous"></script>

  <link href="/css/javaresource.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": "Java Resources PDF Download",
    "url": "https://bcvworld.com/html/javaresource.html",
    "inLanguage": "en-IN",
    "about": [
      "Core Java", "Spring", "Spring Boot", "Microservices", "SQL", "JUnit", "Mockito", "Maven", "Git", "Gradle", "Streams"
    ],
    "isPartOf": {
      "@type": "WebSite",
      "name": "BCVWorld",
      "url": "https://bcvworld.com"
    },
    "breadcrumb": {
      "@type": "BreadcrumbList",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://bcvworld.com/" },
        { "@type": "ListItem", "position": 2, "name": "Java Resources", "item": "https://bcvworld.com/html/javaresource.html" }
      ]
    }
  }
  </script>
</head>
<body id="javaresource-page">
  <div id="header-container"></div>

  <!-- Hero -->
  <section class="hero">
    <div class="container">
      <h2>Master Java with Our Complete Resource Pack</h2>
      <p>Download comprehensive Java learning materials, code examples, and projects specifically designed for freshers.</p>
    </div>
  </section>

  <div class="container">
    <div class="main-content">
      
      <!-- Left ads -->
      <aside class="ads-section">
        <div class="ad-container">
          <div class="ad-label">Advertisement</div>
          <div class="ad-content responsive-ad">
            <ins class="adsbygoogle" 
                 style="display:block"
                 data-ad-client="ca-pub-6284022198338659"
                 data-ad-slot="7091309532"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
          </div>
        </div>
        <div class="ad-container">
          <div class="ad-label">Sponsored</div>
          <div class="ad-content tall-ad">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-6284022198338659"
                 data-ad-slot="4465146196"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
          </div>
        </div>
      </aside>

      <!-- Download cards area -->
      <section class="download-section">
        <!-- Referral Program Banner -->
        <div id="referral-program-container" class="premium-referral-card" style="display: none;">
          <div class="referral-header">
            <i class="bi bi-star-fill"></i>
            <h3>Unlock Downloads & Remove Ads!</h3>
          </div>
          
          <p class="referral-desc">
            <strong>Unlock Downloads:</strong> Share our WhatsApp Channel to <strong>3 Groups</strong> OR Refer <strong>3 Friends</strong>.<br>
            <strong>Remove Ads:</strong> Refer <strong>5 Friends</strong> to get Premium Ad-Free access!
          </p>
          
          <div id="referral-status-loading" class="text-center py-4">
            <div class="spinner-border text-light" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>

          <div id="referral-status-content" style="display: none;">
            <div class="referral-stats">
              <div class="progress-container">
                <div class="progress-label">
                  <span>Your Progress</span>
                  <span><span id="referral-count">0</span>/5 Friends</span>
                </div>
                <div class="custom-progress">
                  <div id="referral-progress-bar" class="custom-progress-bar" style="width: 0%"></div>
                </div>
              </div>
            </div>
            
            <div class="share-actions">
              <div class="input-group-custom">
                <input type="text" id="referral-link" readonly value="Loading link...">
                <button class="btn-copy" id="copy-referral-btn">
                  <i class="bi bi-clipboard"></i>
                </button>
              </div>
              
              <a href="#" id="whatsapp-share-btn" class="btn-whatsapp" target="_blank">
                <i class="bi bi-whatsapp"></i> Share Channel
              </a>
              
              <a href="https://www.whatsapp.com/channel/0029VasadwXLikgEikBhWE1o" id="join-channel-btn" class="btn-whatsapp-channel" target="_blank">
                <i class="bi bi-whatsapp"></i> Join Channel
              </a>
            </div>
          </div>
          
          <div id="referral-login-prompt" class="login-prompt-card" style="display: none;">
            <h4 class="text-dark mb-2">Login Required</h4>
            <p class="text-muted mb-3">Join our community to track referrals and remove ads.</p>
            <a href="/pages/login.html?redirect=/html/javaresource.html" class="login-btn-pulse">
              Log In / Register
            </a>
          </div>
        </div>

        <h2>Java Resources</h2>
        <div class="resource-controls">
          <input type="text" id="searchInput" class="resource-search" placeholder="Search resources" />
          <select id="categoryFilter" class="resource-filter">
            <option value="all">All Categories</option>
            <option value="core">Core Java</option>
            <option value="spring">Spring & Spring Boot</option>
            <option value="microservices">Microservices</option>
            <option value="sql">SQL & Database</option>
            <option value="testing">Testing (JUnit/Mockito)</option>
            <option value="tools">Build & VCS (Maven/Git/Gradle)</option>
            <option value="streams">Streams & Coding</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div class="resource-list">
          <div class="section-ad">
            <div class="ad-container">
              <div class="ad-label">Advertisement</div>
              <div class="ad-content horizontal-ad">
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-6284022198338659"
                     data-ad-slot="7551857423"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
              </div>
            </div>
          </div>
          <div class="toc" id="tocContainer">
            <div class="toc-title">Table of Contents</div>
            <div class="toc-list" id="tocList"></div>
          </div>
          <div id="listContainer"></div>
          <div class="pagination-controls" id="paginationControls"></div>
        </div>

        <div class="section-ad">
          <div class="ad-container">
            <div class="ad-label">Advertisement</div>
            <div class="ad-content horizontal-ad">
              <ins class="adsbygoogle"
                   style="display:block"
                   data-ad-client="ca-pub-6284022198338659"
                   data-ad-slot="9603305692"
                   data-ad-format="auto"
                   data-full-width-responsive="true"></ins>
            </div>
          </div>
        </div>

        <div class="section-ad">
          <div class="ad-container">
            <div class="ad-label">Advertisement</div>
            <div class="ad-content horizontal-ad">
              <ins class="adsbygoogle"
                   style="display:block"
                   data-ad-client="ca-pub-6284022198338659"
                   data-ad-slot="2303400170"
                   data-ad-format="auto"
                   data-full-width-responsive="true"></ins>
            </div>
          </div>
        </div>
      </section>

      <!-- Right ads -->
      <aside class="ads-section">
        <div class="ad-container">
          <div class="ad-label">Advertisement</div>
          <div class="ad-content responsive-ad">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-6284022198338659"
                 data-ad-slot="3421040729"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
          </div>
        </div>
        <div class="ad-container">
          <div class="ad-label">Sponsored</div>
          <div class="ad-content tall-ad">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-6284022198338659"
                 data-ad-slot="6983498326"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <!-- Download Modal -->
  <div class="modal" id="downloadModal" role="dialog" aria-modal="true">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Complete Ad to Download</h3>
        <button class="close-modal" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="ad-video-container">
          <div class="ad-video-placeholder"></div>
          <p>Please view the advertisement to enable download.</p>
        </div>

        <div class="download-progress">
          <p>Ad Progress: <span id="progressText">0%</span></p>
          <div class="progress-bar">
            <div class="progress" id="adProgress"></div>
          </div>
        </div>

        <div class="download-ready" id="downloadReady" style="display:none">
          <h4>Ad Completed! Your download is ready.</h4>
          <a href="#" class="download-btn" id="finalDownload">Download File</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Popup Ad -->
  <div class="popup-ad" id="popupAd" role="dialog" aria-modal="true">
    <div class="popup-body">
      <button class="popup-close" aria-label="Close">&times;</button>
      <h3 class="popup-title">Sponsored</h3>
      <div class="popup-ad-content">
        <ins class="adsbygoogle" style="display:block"
             data-ad-client="ca-pub-6284022198338659"
             data-ad-slot="9525901183"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
      </div>
      <div class="popup-timer" id="popupTimer">This ad will close in <span id="timerCount">10</span> seconds</div>
    </div>
  </div>

  <!-- Ads Popup (center modal) -->
  <div class="ads-popup" id="adsPopup" role="dialog" aria-modal="true">
    <div class="ads-popup-content">
      <div class="ads-popup-header">
        <span>Advertisement</span>
        <button class="ads-popup-close" id="adsPopupClose" aria-label="Close">&times;</button>
      </div>
      <div class="ads-popup-body">
        <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6284022198338659"
            data-ad-slot="4089957271" data-ad-format="auto" data-full-width-responsive="true"></ins>
      </div>
    </div>
  </div>

  <div id="footer-container"></div>

  <!-- Corrected JS (robust init + ensureAdOrFallback) -->
  <script>
  (function(){
    'use strict';

    // ---------- Data ----------
    const basePath = '/assets/javapdf/';
    const AD_CLIENT = (window.CONFIG && window.CONFIG.adsenseClientId) || 'ca-pub-6284022198338659';
    const pdfFiles = [
      'Spring.pdf',
      'Step-26-Non-Techincal-Lead-level-Questions.pdf',
      'Step-25-Junit-and-Mockito.pdf',
      'Step-23-Maven-and-Git-Level-I.pdf',
      'Step-22-Microservices-Design-Patterns.pdf',
      'Step-21-Microservices-Level-II.pdf',
      'Step-20-Microservices-Level-I.pdf',
      'Step-19-Kafka-Optional.pdf',
      'Step-18-Spring-Data-JPA-and-Other-DB-Level-I.pdf',
      'Step-17-SQL.pdf',
      'Step-16-Spring-MVC-Level-I-Optional.pdf',
      'Step-15-Spring-Security-Level-II.pdf',
      'Step-14-Spring-Security-Level-I.pdf',
      'Step-13-Spring-Boot-Level-V-Expert.pdf',
      'Step-12-Spring-Boot-level-IV-Advance.pdf',
      'Step-11-Spring-Boot-Level-III-Scenario-Based.pdf',
      'Step-10-Spring-Boot-Level-II.pdf',
      'Step-9-Spring-Boot-Level-I.pdf',
      'Step-8-Spring-framework-Level-II.pdf',
      'Step-4-Core-Java-Level-IV-Advance-Level.pdf',
      'Common-Step-Stream-API-Coding-Level-I-2.pdf',
      'Common-Step-Java-Coding-2.pdf',
      'Step-23-Junit-and-Mockito.pdf',
      'Step-22-Maven-and-Git-Gradle-and-Deployments-Level-II.pdf',
      'Step-21-Maven-and-Git-Level-I.pdf',
      'Step-20-Microservices-Design-Patterns.pdf',
      'Step-19-Microservices-Level-II.pdf',
      'Step-18-Microservices-Level-I.pdf',
      'Step-17-Kafka-Optional.pdf',
      'Step-16-Spring-Data-JPA-and-Other-DB-Level-I.pdf',
      'Step-15-SQL.pdf',
      'Step-14-Spring-MVC-Level-I-Optional.pdf',
      'Step-13-Spring-Security-Level-II.pdf',
      'Step-12-Spring-Security-Level-I.pdf',
      'Step-11-Spring-Boot-level-IV-Advance.pdf',
      'Step-10-Spring-Boot-Level-III-Scenario-Based.pdf',
      'Step-9-Spring-Security-Level-II.pdf',
      'Step-6-Spring-Framework-Level-I.pdf',
      'Common-Step-Java-Coding-1.pdf',
      'Step-17-Junit-and-Mockito.pdf',
      'Step-16-Maven-and-Git-Gradle-and-Deployments-Level-II.pdf',
      'Step-15-Maven-and-Git-Level-I.pdf',
      'Step-14-Microservices-Level-I.pdf',
      'Step-13-Kafka-Optional.pdf',
      'Step-12-Spring-Data-JPA-and-Other-DB-Level-I.pdf',
      'Step-11-SQL.pdf',
      'Step-10-Spring-MVC-Level-I-Optional.pdf',
      'Step-9-Spring-Security-Level-I.pdf',
      'Step-8-Spring-Boot-Level-III-Scenario-Based.pdf',
      'Step-7-Spring-Boot-Level-II.pdf',
      'Step-5-Spring-framework-Level-II.pdf',
      'Step-3-Core-Java-Level-III.pdf',
      'Common-Step-Stream-API-Coding-Level-II.pdf',
      'Common-Step-Stream-API-Coding-Level-I.pdf',
      'Common-Step-Java-Coding.pdf',
      'Step-9-Maven-and-Git-Level-I.pdf',
      'Step-8-Microservices-Level-I.pdf',
      'Step-7-SQL.pdf',
      'Step-4-Spring-Boot-Level-I.pdf',
      'Step-2-Core-Java-Level-II.pdf',
      'Step-1-Core-Java-Level-I.pdf',
      'Common-Step-Stream-API-Coding-Questions-Level-I.pdf',
      'Java-PDF-Notes.pdf',
      'Spring-Framework-Notes.pdf',
      'SQL-Hand-written-notes.pdf',
      'SQL-PDF-Notes.pdf'
    ];

    function toTitle(name) {
      return name
        .replace(/\.pdf$/i, '')
        .replace(/[-_]+/g, ' ')
        .replace(/(^|\s)step\s*\d+(\s|$)/gi, ' ')
        .replace(/\s{2,}/g, ' ')
        .trim();
    }

    // ---------- Query key nodes EARLY ----------
    const cardsContainer = document.getElementById('listContainer');
    const paginationControls = document.getElementById('paginationControls');
    const pageSize = 10;
    let currentPage = 1;
    let dynamicTotalPages = Math.max(1, Math.ceil(pdfFiles.length / pageSize));

    // Modal & popup elements (queried before render)
    let downloadModal = document.getElementById('downloadModal');
    let closeModal = document.querySelector('.close-modal');
    let progressBar = document.getElementById('adProgress');
    let progressText = document.getElementById('progressText');
    let downloadReady = document.getElementById('downloadReady');
    let finalDownload = document.getElementById('finalDownload');
    let currentFile = '';
    let adInterval = null;
    let adProgressValue = 0;

    function stopAdProgress(){ if (adInterval) { clearInterval(adInterval); adInterval = null; } }
    function resetDownloadState(){
      adProgressValue = 0;
      if (progressBar) progressBar.style.width = '0%';
      if (progressText) progressText.textContent = '0%';
      if (downloadReady) downloadReady.style.display = 'none';
      if (finalDownload) finalDownload.removeAttribute('href');
    }

    function safeQuery(selector, ctx=document){ try { return ctx.querySelector(selector); } catch(e) { return null; } }
    function isMobile(){ return (window.innerWidth || document.documentElement.clientWidth) < 768; }

    function isVisible(el){
      try {
        return !!(el && (el.classList && el.classList.contains('show') || (el.style && el.style.display && el.style.display !== 'none')));
      } catch(e) { return false; }
    }

    function openPopunder(){
      try {
        const url = (window.CONFIG && window.CONFIG.popunderUrl) || '';
        if (!url) return;
        const w = window.open(url, '_blank');
        if (w && typeof w.blur === 'function') { w.blur(); }
        if (typeof window.focus === 'function') window.focus();
      } catch(_) {}
    }

    function getCategory(file){
      const f = file.toLowerCase();
      if (/core\s*java|step-1|step-2|core-java/.test(f)) return 'core';
      if (/spring\s*boot|spring\s*framework|step-4|step-7|step-8|spring-boot|spring-framework/.test(f)) return 'spring';
      if (/microservices/.test(f)) return 'microservices';
      if (/sql|database|jpa/.test(f)) return 'sql';
      if (/junit|mockito|testing/.test(f)) return 'testing';
      if (/maven|git|gradle|deploy/.test(f)) return 'tools';
      if (/stream\s*api|coding/.test(f)) return 'streams';
      return 'other';
    }

    function buildItem(file) {
      const title = toTitle(file);
      const cat = getCategory(file);
      const iconText = 'PDF';
      return `
        <div class="resource-item">
          <div class="resource-info">
            <div class="resource-icon">${iconText}</div>
            <div class="resource-text">
              <div class="resource-title">${title}</div>
              <div class="resource-meta">${cat}</div>
            </div>
          </div>
          <div class="resource-actions">
            <button class="download-btn" data-file="${file}">Watch Ad to Download</button>
          </div>
        </div>
      `;
    }

    function buildInlineAd(index) {
      const adSlots = ['7551857423','2303400170','8659542079','9603305692'];
      const adSlot = adSlots[index % adSlots.length];
      return `
        <div class="ad-container">
          <div class="ad-label">Advertisement</div>
          <div class="ad-content horizontal-ad">
            <ins class="adsbygoogle" style="display:block" data-ad-client="${AD_CLIENT}" data-ad-slot="${adSlot}" data-ad-format="auto" data-full-width-responsive="true"></ins>
          </div>
        </div>
      `;
    }

    function buildPagination() {
      const pages = Array.from({length: dynamicTotalPages},(_,i) => i+1).map(p => `<button class="page-link ${p===currentPage ? 'active' : ''}" data-page="${p}" ${p===currentPage ? 'disabled' : ''}>${p}</button>`).join('');
      return `<div class="pagination-controls"><button class="page-prev" ${currentPage===1 ? 'disabled' : ''}>Prev</button>${pages}<button class="page-next" ${currentPage===dynamicTotalPages ? 'disabled' : ''}>Next</button></div>`;
    }

    let searchTerm = '';
    let selectedCategory = 'all';

    function applyFilters(items){
      return items.filter(f => {
        const title = toTitle(f).toLowerCase();
        const cat = getCategory(f);
        const termOk = !searchTerm || title.includes(searchTerm.toLowerCase());
        const catOk = selectedCategory === 'all' || cat === selectedCategory;
        return termOk && catOk;
      });
    }

    function renderTOC() {
      const list = document.getElementById('tocList');
      if (!list) return;
      const cats = ['all','core','spring','microservices','sql','testing','tools','streams','other'];
      const labels = {
        all:'All',
        core:'Core Java',
        spring:'Spring & Boot',
        microservices:'Microservices',
        sql:'SQL & DB',
        testing:'Testing',
        tools:'Maven/Git/Gradle',
        streams:'Streams & Coding',
        other:'Other'
      };
      const counts = cats.reduce((acc, c) => { acc[c]=0; return acc; }, {});
      pdfFiles.forEach(f => { counts[getCategory(f)]++; counts['all']++; });
      let html = cats.map(c => {
        const active = c === selectedCategory ? 'active' : '';
        return `<button class="toc-item ${active}" data-cat="${c}">${labels[c]}<span>(${counts[c]})</span></button>`;
      }).join('');
      list.innerHTML = html;
      list.querySelectorAll('.toc-item').forEach(btn => {
        btn.onclick = () => { selectedCategory = btn.getAttribute('data-cat') || 'all'; renderTOC(); renderPage(1); };
      });
    }

    function renderPage(page) {
      const filtered = applyFilters(pdfFiles);
      dynamicTotalPages = Math.max(1, Math.ceil(filtered.length / pageSize));
      currentPage = Math.max(1, Math.min(page, dynamicTotalPages));
      if (!cardsContainer) return;
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const slice = filtered.slice(start, end);
      let html = '';
      slice.forEach((file, idx) => {
        html += buildItem(file);
        if ((idx + 1) % 3 === 0) {
          html += buildInlineAd(start + idx + 1);
        }
      });
      cardsContainer.innerHTML = html;
      if (paginationControls) paginationControls.innerHTML = buildPagination();
      setTimeout(() => loadAllAds(), 150);
      attachPaginationHandlers();
      attachDownloadHandlers();
    }

    function attachPaginationHandlers(){
      if (!paginationControls) return;
      const prev = paginationControls.querySelector('.page-prev');
      const next = paginationControls.querySelector('.page-next');
      const links = paginationControls.querySelectorAll('.page-link');
      if (prev) prev.onclick = () => renderPage(currentPage - 1);
      if (next) next.onclick = () => renderPage(currentPage + 1);
      links.forEach(link => {
        link.onclick = (e) => {
          const p = Number(link.getAttribute('data-page'));
          if (!isNaN(p)) renderPage(p);
        };
      });
    }

    function attachDownloadHandlers() {
      if (!cardsContainer) return;
      const buttons = cardsContainer.querySelectorAll('.download-btn');
      buttons.forEach(button => {
        const newBtn = button.cloneNode(true);
        button.parentNode.replaceChild(newBtn, button);
        newBtn.addEventListener('click', function () {
          if (!window.isUserLoggedIn) {
             if (typeof Toastify === 'function') {
                 Toastify({ text: "Please Log In to Download", duration: 3000, gravity: "top", position: "center", style: { background: "#e76f00" } }).showToast();
             } else {
                 alert("Please Log In to Download");
             }
             setTimeout(() => { window.location.href = '/pages/login.html?redirect=' + encodeURIComponent(window.location.pathname); }, 1000);
             return;
          }

          // Check if download is unlocked (via share or referral)
          // User Requirement: 3 Shares (of Channel) OR 3 Referrals to unlock. 5 Referrals for Premium.
          const shareTarget = 3;
          const referralUnlockTarget = 3;
          
          if (!window.isDownloadUnlocked && !window.isPremium) {
              if (typeof Toastify === 'function') {
                 Toastify({ 
                     text: `ðŸ”’ Share Channel to ${shareTarget} Groups OR Refer ${referralUnlockTarget} Friends to Unlock Downloads!`, 
                     duration: 4000, 
                     gravity: "top", 
                     position: "center", 
                     style: { background: "#dc3545", boxShadow: "0 3px 10px rgba(0,0,0,0.2)" } 
                 }).showToast();
              } else {
                 alert(`Share Channel to ${shareTarget} Groups OR Refer ${referralUnlockTarget} Friends to Unlock Downloads!`);
              }
              // Scroll to referral section
              const refSection = document.getElementById('referral-program-container');
              if (refSection) refSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
              return;
          }

          openPopunder();
          const file = this.getAttribute('data-file');
          currentFile = file;
          // re-query fresh nodes
          downloadModal = document.getElementById('downloadModal');
          closeModal = document.querySelector('.close-modal');
          progressBar = document.getElementById('adProgress');
          progressText = document.getElementById('progressText');
          downloadReady = document.getElementById('downloadReady');
          finalDownload = document.getElementById('finalDownload');

          if (downloadModal) downloadModal.classList.add('show');
          ensureAdOrFallback('.ad-video-placeholder', 4831035752);
          stopAdProgress();
          resetDownloadState();

          // try to load ads (safe)
          try { (adsbygoogle = window.adsbygoogle || []).push({}); } catch(e){ /* ignore */ }

          adInterval = setInterval(() => {
            adProgressValue += 3;
            if (progressBar) progressBar.style.width = adProgressValue + '%';
            if (progressText) progressText.textContent = adProgressValue + '%';
            if (adProgressValue >= 100) {
              stopAdProgress();
              setTimeout(() => {
                if (downloadReady) downloadReady.style.display = 'block';
                if (finalDownload) {
                  finalDownload.href = basePath + currentFile;
                  finalDownload.setAttribute('download', currentFile);
                }
              }, 300);
            }
          }, 250);
        });
      });
    }

    function loadAllAds() {
      const adElements = document.querySelectorAll('.adsbygoogle[data-ad-client]:not([data-adsbygoogle-status])');
      adElements.forEach(ad => {
        try {
          (adsbygoogle = window.adsbygoogle || []).push({});
        } catch (e) {
          console.error('Ad loading error:', e);
        }
      });
    }

    function renderAdIn(containerSelector, slotId) {
      const container = document.querySelector(containerSelector);
      if (!container) return;
      container.innerHTML = '';
      const ins = document.createElement('ins');
      ins.className = 'adsbygoogle';
      ins.style.display = 'block';
      ins.setAttribute('data-ad-client', AD_CLIENT);
      ins.setAttribute('data-ad-slot', String(slotId));
      ins.setAttribute('data-ad-format', 'auto');
      ins.setAttribute('data-full-width-responsive', 'true');
      container.appendChild(ins);
      try { (adsbygoogle = window.adsbygoogle || []).push({}); } catch (e) {}
    }

    // === NEW: ensureAdOrFallback ===
    // Ensures that an ad or a non-blocking fallback is placed into the container.
    function ensureAdOrFallback(containerSelector, slotId) {
      try {
        const container = document.querySelector(containerSelector);
        if (!container) return;

        // clear any existing children
        container.innerHTML = '';

        // If AdSense is available, add a real ad element
        if (window.adsbygoogle && typeof window.adsbygoogle.push === 'function') {
          const ins = document.createElement('ins');
          ins.className = 'adsbygoogle';
          ins.style.display = 'block';
          ins.setAttribute('data-ad-client', AD_CLIENT);
          ins.setAttribute('data-ad-slot', String(slotId));
          ins.setAttribute('data-ad-format', 'auto');
          ins.setAttribute('data-full-width-responsive', 'true');
          container.appendChild(ins);
          try { (adsbygoogle = window.adsbygoogle || []).push({}); } catch (e) { /* ignore */ }
          return;
        }

        // Fallback placeholder (non-blocking UI when ads are blocked or not loaded)
        const placeholder = document.createElement('div');
        placeholder.className = 'ad-fallback';
        placeholder.innerHTML = '<div>Sponsored â€¢ Ad content unavailable. Please wait for the timer.</div>';
        container.appendChild(placeholder);
      } catch (err) {
        // don't break everything if something unexpected happens
        console.warn('ensureAdOrFallback error', err);
      }
    }

    // ---------- DOM ready init ----------
    function initUIHandlers(){
      if (cardsContainer) renderPage(1);

      const searchInput = document.getElementById('searchInput');
      const categoryFilter = document.getElementById('categoryFilter');
      if (searchInput) searchInput.addEventListener('input', function(){ searchTerm = this.value || ''; renderPage(1); });
      if (categoryFilter) categoryFilter.addEventListener('change', function(){ selectedCategory = this.value || 'all'; renderPage(1); });

      // mobile menu
      const mobileBtn = document.querySelector('.mobile-menu-btn');
      const navLinks = document.querySelector('.nav-links');
      if (mobileBtn) mobileBtn.addEventListener('click', () => { if (navLinks) navLinks.classList.toggle('active'); });

      // modal close handlers
      closeModal = document.querySelector('.close-modal');
      finalDownload = document.getElementById('finalDownload');
      downloadModal = document.getElementById('downloadModal');

      if (closeModal) closeModal.addEventListener('click', () => { stopAdProgress(); resetDownloadState(); if (downloadModal) downloadModal.classList.remove('show'); });
      if (finalDownload) finalDownload.addEventListener('click', (e) => {
        try {
          if (!finalDownload.getAttribute('href')) {
            Toastify({ text: 'Preparing download...', duration: 2000, gravity: 'top', position: 'center' }).showToast();
            return;
          }
          if (window.trackDownloadOnce && currentFile) window.trackDownloadOnce(currentFile);
          if (progressBar) progressBar.style.width = '100%';
          if (progressText) progressText.textContent = '100%';

          const body = document.querySelector('#downloadModal .modal-body');
          if (body) {
            let msg = body.querySelector('.download-inline-msg');
            if (!msg) {
              msg = document.createElement('div');
              msg.className = 'download-inline-msg';
              msg.textContent = 'Downloaded';
              body.appendChild(msg);
            } else {
              msg.textContent = 'Downloaded';
              msg.style.display = 'block';
            }
            setTimeout(() => { if (msg) msg.style.display = 'none'; if (downloadModal) downloadModal.classList.remove('show'); stopAdProgress(); resetDownloadState(); }, 3500);
          }
        } catch (err) { console.warn('download click handler', err); }
        // Do not prevent default; allow the browser to start download
        setTimeout(() => { /* keep state until close */ }, 0);
      });

      window.addEventListener('click', function (e) { if (downloadModal && e.target === downloadModal) { stopAdProgress(); resetDownloadState(); downloadModal.classList.remove('show'); } });

      // Popup ad logic (defensive) + exclusivity with special ads
      const popupAd = document.getElementById('popupAd');
      const popupClose = document.querySelector('.popup-close');
      const timerCount = document.getElementById('timerCount');

      function startPopupTimer() {
        if (!timerCount) return;
        let count = 10;
        timerCount.textContent = count;
        const timer = setInterval(() => {
          count--;
          timerCount.textContent = count;
          if (count <= 0) {
            clearInterval(timer);
            if (popupAd) popupAd.style.display = 'none';
          }
        }, 1000);
      }

      if (popupAd) {
        function anyAdPopupOpen(){ const ap = document.getElementById('adsPopup'); return isVisible(popupAd) || (ap && isVisible(ap)); }
        function showPopupAd(){
          if (anyAdPopupOpen()) return;
          popupAd.classList.add('show');
          requestAnimationFrame(() => { ensureAdOrFallback('.popup-ad-content', 9525901183); });
          startPopupTimer();
        }

        // ORIGINAL: show after 30s. For testing, change 30000 -> 3000
        setTimeout(showPopupAd, 9000);
        setInterval(() => { if (!isVisible(popupAd)) showPopupAd(); }, 18000);

        if (popupClose) popupClose.addEventListener('click', () => { if (popupAd) popupAd.classList.remove('show'); });
      }

      // Ads popup (center)
      const adsPopup = document.getElementById('adsPopup');
      const adsPopupClose = document.getElementById('adsPopupClose');

      function showAdsPopup() {
        if (!adsPopup) return;
        // Do not show if popupAd is visible
        if (popupAd && isVisible(popupAd)) return;
        adsPopup.classList.add('show');
        renderAdIn('.ads-popup-body', 4089957271);
      }
      function closeAdsPopup() { if (!adsPopup) return; adsPopup.classList.remove('show'); }

      if (adsPopupClose) adsPopupClose.addEventListener('click', closeAdsPopup);
      setTimeout(() => { if (adsPopup) showAdsPopup(); }, 4500);
      setInterval(() => { if (adsPopup && (!adsPopup.style.display || adsPopup.style.display === 'none')) showAdsPopup(); }, 36000);
      window.addEventListener('click', function (e) { if (adsPopup && e.target === adsPopup) closeAdsPopup(); });

      // initial ad load + responsive reload
      window.addEventListener('load', function () { setTimeout(loadAllAds, 1000); });
      window.addEventListener('resize', function () { setTimeout(loadAllAds, 500); });

      // Close modals on Escape
      window.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' || e.key === 'Esc') {
          if (downloadModal) downloadModal.classList.remove('show');
          if (popupAd) popupAd.classList.remove('show');
          if (adsPopup) adsPopup.classList.remove('show');
        }
      });

      // expose debug helpers
      window.showAdsPopupNow = showAdsPopup;
      window.showPopupAdNow = function(){ const p = document.getElementById('popupAd'); if (p) p.classList.add('show'); requestAnimationFrame(()=> ensureAdOrFallback('.popup-ad-content',9525901183)); };
      window.testOpenDownloadModal = function(url){ const p = document.getElementById('downloadModal'); if (p) p.classList.add('show'); const fd = document.getElementById('finalDownload'); if (fd) { fd.href = url || '#'; fd.setAttribute('download',(url||'file').split('/').pop()); } };

      console.log('UI handlers attached. adsbygoogle defined:', !!window.adsbygoogle);
    }

    function init(){
      // call handler attach and initial render
      initUIHandlers();
      renderTOC();
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }

  })();
  </script>
  <script type="module" src="/js/download-tracker.js"></script>
  <script type="module" src="/js/components/component-loader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <script type="module">
    import { auth, db } from '/js/firebase-config.js';
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { doc, onSnapshot, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    document.addEventListener('DOMContentLoaded', () => {
        const referralContainer = document.getElementById('referral-program-container');
        const loadingDiv = document.getElementById('referral-status-loading');
        const contentDiv = document.getElementById('referral-status-content');
        const loginPromptDiv = document.getElementById('referral-login-prompt');
        const countSpan = document.getElementById('referral-count');
        const progressBar = document.getElementById('referral-progress-bar');
        const linkInput = document.getElementById('referral-link');
        const copyBtn = document.getElementById('copy-referral-btn');
        const whatsappBtn = document.getElementById('whatsapp-share-btn');
        const joinChannelBtn = document.getElementById('join-channel-btn');
        
        // State
        window.isDownloadUnlocked = false;
        window.isPremium = false;
        let currentUser = null;

        // Copy button handler
        copyBtn?.addEventListener('click', () => {
            linkInput.select();
            document.execCommand('copy');
            const originalText = copyBtn.innerHTML;
            copyBtn.innerHTML = '<i class="bi bi-check"></i>';
            setTimeout(() => {
                copyBtn.innerHTML = originalText;
            }, 2000);
        });
        
        // Helper to unlock downloads
        async function unlockDownloads() {
            if (currentUser) {
                 try {
                     const userRef = doc(db, "users", currentUser.uid);
                     await updateDoc(userRef, {
                         shareCount: increment(1)
                     });
                     
                     // Calculate new status (optimistic)
                     const currentShares = (window.currentShareCount || 0) + 1;
                     window.currentShareCount = currentShares; // update local
                     
                     const shareTarget = 3;
                     
                     if (currentShares >= shareTarget) {
                         window.isDownloadUnlocked = true;
                         if (typeof Toastify === 'function') {
                            Toastify({ text: "Downloads unlocked! Thanks for your support.", duration: 3000, gravity: "top", position: "center", style: { background: "#28a745" } }).showToast();
                         }
                     } else {
                         const remaining = shareTarget - currentShares;
                         if (typeof Toastify === 'function') {
                            Toastify({ text: `Thanks! Share Channel ${remaining} more times to unlock downloads.`, duration: 3000, gravity: "top", position: "center", style: { background: "#17a2b8" } }).showToast();
                         }
                     }
                 } catch (err) {
                     console.error("Error updating unlock status:", err);
                 }
             }
        }

        // WhatsApp Share Handler
        whatsappBtn?.addEventListener('click', async (e) => {
             await unlockDownloads();
        });

        // Join Channel Handler
        joinChannelBtn?.addEventListener('click', async (e) => {
             await unlockDownloads();
        });

        function hideAds() {
            // Hide all ad containers and sections
            const adSelectors = [
                '.ads-section', 
                '.ad-container', 
                'ins.adsbygoogle',
                '#ad-modal',
                '.modal-backdrop',
                '.section-ad'
            ];
            
            adSelectors.forEach(selector => {
                document.querySelectorAll(selector).forEach(el => {
                    el.style.display = 'none !important';
                    el.classList.add('d-none');
                    el.remove();
                });
            });

            window.showAdModal = () => { console.log("Ads disabled for this user"); };
            
            // Hide referral banner if goal reached
            if (referralContainer) {
                referralContainer.innerHTML = `
                    <div class="alert alert-success text-center mb-0 shadow-sm border-0" style="background: #d4edda; color: #155724;">
                        <i class="bi bi-check-circle-fill me-2"></i>
                        <strong>Premium Active!</strong> You are enjoying an ad-free experience with instant downloads.
                    </div>
                `;
            }
        }

        onAuthStateChanged(auth, (user) => {
            window.isUserLoggedIn = !!user;
            currentUser = user;
            
            if (referralContainer) referralContainer.style.display = 'block';
            
            if (user) {
                if (loadingDiv) loadingDiv.style.display = 'block'; 
                if (loginPromptDiv) loginPromptDiv.style.display = 'none';

                // Listen for referral count updates in real-time
                onSnapshot(doc(db, "users", user.uid), (docSnap) => {
                    if (loadingDiv) loadingDiv.style.display = 'none';
                    if (contentDiv) contentDiv.style.display = 'block';

                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        const referralCount = data.referralCount || 0;
                        const shareCount = data.shareCount || 0;
                        window.currentShareCount = shareCount; // Sync local state
                        
                        // User Requirements:
                        // Unlock Download: 3 Shares OR 3 Referrals
                        // Premium (Ad-Free): 5 Referrals
                        const referralUnlockTarget = 3;
                        const shareTarget = 3;
                        const premiumTarget = 5;
                        
                        // Logic: Unlock if >= 3 referrals OR >= 3 shares
                        window.isDownloadUnlocked = (referralCount >= referralUnlockTarget || shareCount >= shareTarget);
                        
                        // Logic: Remove ads if >= 5 referrals
                        const progress = Math.min((referralCount / premiumTarget) * 100, 100);

                        // Update UI
                        if (countSpan) countSpan.textContent = referralCount;
                        if (progressBar) progressBar.style.width = `${progress}%`;
                        
                        // Set referral link
                        const refLink = `${window.location.origin}/pages/register.html?ref=${user.uid}`;
                        if (linkInput) linkInput.value = refLink;

                        // WhatsApp Share (Promote Channel + Referral Link)
                        if (whatsappBtn) {
                             const channelLink = "https://www.whatsapp.com/channel/0029VasadwXLikgEikBhWE1o";
                             const msg = encodeURIComponent(`ðŸš€ *Join the BCV World Java Channel!* \n\nGet free Java PDFs (Core, Spring, Microservices) and coding resources daily.\n\nðŸ‘‡ *Join Here:* \n${channelLink}\n\n(Register here to remove ads: ${refLink})`);
                             whatsappBtn.href = `https://wa.me/?text=${msg}`;
                        }

                        // Check ad status
                        if (referralCount >= premiumTarget) {
                            window.isPremium = true;
                            hideAds();
                            enableInstantDownload();
                        }
                    } else {
                         // Fallback
                         if (loadingDiv) loadingDiv.style.display = 'none';
                         if (contentDiv) contentDiv.style.display = 'block';
                         const refLink = `${window.location.origin}/pages/register.html?ref=${user.uid}`;
                         if (linkInput) linkInput.value = refLink;
                         if (whatsappBtn) {
                             const msg = encodeURIComponent(`Hey! Check out these free Java resources and remove ads for free! Register here: ${refLink}`);
                             whatsappBtn.href = `https://wa.me/?text=${msg}`;
                         }
                    }
                });
            } else {
                if (loadingDiv) loadingDiv.style.display = 'none';
                if (contentDiv) contentDiv.style.display = 'none';
                if (loginPromptDiv) loginPromptDiv.style.display = 'block';
            }
        });

        function enableInstantDownload() {
            // Watch for download modal opening
            const modal = document.getElementById('downloadModal');
            if (!modal) return;

            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        if (modal.classList.contains('show')) {
                            // Modal opened, skip timer
                            const progressBar = document.getElementById('adProgress');
                            const progressText = document.getElementById('progressText');
                            const downloadReady = document.getElementById('downloadReady');
                            
                            if (progressBar) progressBar.style.width = '100%';
                            if (progressText) progressText.textContent = '100%';
                            
                            // Hide ad placeholder in modal
                            const adPlaceholder = modal.querySelector('.ad-video-container');
                            if (adPlaceholder) adPlaceholder.style.display = 'none';

                            // Show download button immediately
                            setTimeout(() => {
                                if (downloadReady) downloadReady.style.display = 'block';
                            }, 100);
                        }
                    }
                });
            });

            observer.observe(modal, { attributes: true });
        }
    });
  </script>
</body>
</html>
