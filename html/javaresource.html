<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Java Resources for Freshers - Download Center</title>

  <!-- Global CONFIG -->
  <script>
    window.CONFIG = {
      // used for simulated ad duration (seconds)
      adWatchSeconds: 15,
      adsenseClientId: 'ca-pub-6284022198338659'
    };
  </script>

  <!-- AdSense script (optional; may be blocked by adblockers) -->
  <script async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6284022198338659"
    crossorigin="anonymous"></script>

  <style>
    :root{
      --primary:#e76f00;--secondary:#5382a1;--dark:#343a40;--success:#28a745;--gray:#6c757d;
    }
    html,body{margin:0;padding:0;font-family:Segoe UI, Tahoma, Geneva, Verdana, sans-serif;background:#f5f5f5;color:var(--dark)}
    .container{max-width:1200px;margin:0 auto;padding:0 15px}
    header{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;padding:1rem 0}
    .header-content{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .nav-links{display:flex;gap:16px}
    .mobile-menu-btn{display:none}
    @media(max-width:768px){.mobile-menu-btn{display:block}.nav-links{display:none}.nav-links.active{display:flex;flex-direction:column}}
    .main-content{display:grid;grid-template-columns:250px 1fr 250px;gap:16px;margin:24px 0}
    @media(max-width:1024px){.main-content{grid-template-columns:1fr}.ads-section{display:none!important}}
    .download-cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px}
    .download-card{background:#fff;border-radius:8px;box-shadow:0 4px 6px rgba(0,0,0,.08);overflow:hidden}
    .card-header{background:var(--secondary);color:#fff;padding:12px}
    .card-body{padding:12px}
    .download-btn{background:var(--primary);color:#fff;padding:10px;border:none;width:100%;border-radius:6px;cursor:pointer}
    .ad-container{margin:0 0 8px 0}
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:2000;align-items:center;justify-content:center}
    .modal-content{background:#fff;border-radius:8px;max-width:520px;width:92%;overflow:hidden}
    .ad-video-placeholder{min-height:180px;display:flex;align-items:center;justify-content:center;background:#f0f0f0;border-radius:4px;padding:12px}
    .progress-bar{background:#e9ecef;height:12px;border-radius:6px;overflow:hidden;margin-top:8px}
    .progress{width:0%;height:100%;background:var(--success);transition:width .25s}
    .btn { padding:8px 12px;border-radius:6px;border:none;cursor:pointer }
    .btn-primary { background:var(--primary); color:#fff }
    .btn-muted { background:#f0f0f0; color:#333 }
    .btn-disabled { opacity:.5; cursor:not-allowed }
    .ad-fallback { font-size: 14px; color: #555; text-align:center; }
    button:focus, a:focus { outline: 3px solid rgba(37,99,235,0.18); outline-offset:2px }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="header-content">
        <div style="display:flex;align-items:center;gap:10px">
          <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="white" stroke-width="1.8"/>
          </svg>
          <h1 style="font-size:1.1rem;margin:0">Java Fresher Resources</h1>
        </div>
        <nav class="nav-links" id="main-nav">
          <a href="/index.html" style="color:white;text-decoration:none">Home</a>
          <a href="/html/javaresource.html" style="color:white;text-decoration:none">Resources</a>
          <a href="/html/about.html" style="color:white;text-decoration:none">About</a>
          <a href="/html/contact.html" style="color:white;text-decoration:none">Contact</a>
        </nav>
      </div>
    </div>
  </header>

  <main class="container">
    <section style="margin:24px 0">
      <h2 style="color:var(--primary);margin-bottom:8px">Available Resources</h2>
      <p style="color:var(--gray);margin-top:0">Click Download to watch a short ad and get the resource.</p>

      <div class="download-cards"></div>
    </section>
  </main>

  <!-- Download Modal (ad must be watched to enable download) -->
  <div class="modal" id="downloadModal" role="dialog" aria-modal="true">
    <div class="modal-content" role="document">
      <div style="display:flex;justify-content:space-between;align-items:center;background:var(--primary);color:#fff;padding:12px">
        <h3 style="margin:0;font-size:1rem">Watch Ad to Enable Download</h3>
        <button class="close-modal" style="background:none;border:none;color:#fff;font-size:20px;cursor:pointer" aria-label="Close">&times;</button>
      </div>

      <div style="padding:14px">
        <div class="ad-video-placeholder" id="adPlaceholder">
          <!-- Ad (or fallback) will be injected here -->
          <div class="ad-fallback">Ad area — will load if available</div>
        </div>

        <p style="margin:10px 0 4px 0;color:var(--gray)">Ad progress: <span id="progressText">0%</span></p>
        <div class="progress-bar" aria-hidden="true">
          <div class="progress" id="adProgress" style="width:0%"></div>
        </div>

        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
          <button id="startAdBtn" class="btn btn-primary">Start Ad</button>
          <a id="finalDownload" class="btn btn-primary btn-disabled" href="#" download target="_blank" aria-disabled="true" style="text-decoration:none;display:inline-block">Download</a>
        </div>
      </div>
    </div>
  </div>

  <footer style="background:#343a40;color:#fff;padding:24px 0;margin-top:24px">
    <div class="container" style="text-align:center;color:#aaa">
      <p>&copy; 2025 Java Fresher Resources. All rights reserved.</p>
    </div>
  </footer>

  <script>
  (function(){
    'use strict';

    // ---------- Data ----------
    const basePath = '/assets/javapdf/';
    const pdfFiles = [
      'Spring.pdf',
      'Step-25-Junit-and-Mockito.pdf',
      'Step-23-Maven-and-Git-Level-I.pdf',
      'Step-20-Microservices-Design-Patterns.pdf',
      'Step-17-SQL.pdf',
      'Java-PDF-Notes.pdf'
    ];

    const cardsContainer = document.querySelector('.download-cards');

    // Modal elements
    const downloadModal = document.getElementById('downloadModal');
    const closeModalBtn = downloadModal ? downloadModal.querySelector('.close-modal') : null;
    const adPlaceholder = document.getElementById('adPlaceholder');
    const startAdBtn = document.getElementById('startAdBtn');
    const progressBar = document.getElementById('adProgress');
    const progressText = document.getElementById('progressText');
    const finalDownload = document.getElementById('finalDownload');

    let currentFile = '';
    let adInterval = null;
    let adProgressValue = 0;
    const adWatchSeconds = (window.CONFIG && window.CONFIG.adWatchSeconds) ? Number(window.CONFIG.adWatchSeconds) : 15;
    const adTickMs = 100; // progress tick every 100ms
    const ticksNeeded = Math.ceil((adWatchSeconds * 1000) / adTickMs);

    // Defensive helpers
    function safeQuery(selector, ctx=document){ try { return ctx.querySelector(selector); } catch(e) { return null; } }
    function toTitle(name){
      return String(name).replace(/\.pdf$/i,'').replace(/[-_]+/g,' ').replace(/\s{2,}/g,' ').trim();
    }

    // Render file cards
    function buildCard(file){
      const title = toTitle(file);
      const el = document.createElement('div');
      el.className = 'download-card';
      el.innerHTML = `
        <div class="card-header"><h3 style="margin:0">${title}</h3></div>
        <div class="card-body">
          <p style="color:var(--gray);margin-bottom:8px">${title} reference PDF</p>
          <div style="margin-bottom:8px"><small>PDF • ${(Math.floor(Math.random()*10)+1)} MB</small></div>
          <button class="download-btn" data-file="${file}">Download Now</button>
        </div>
      `;
      return el;
    }

    function renderList(){
      if (!cardsContainer) return;
      cardsContainer.innerHTML = '';
      pdfFiles.forEach(f => {
        const card = buildCard(f);
        cardsContainer.appendChild(card);
      });
      attachDownloadHandlers();
    }

    // Attach handlers to download buttons
    function attachDownloadHandlers(){
      if (!cardsContainer) return;
      const buttons = cardsContainer.querySelectorAll('.download-btn');
      buttons.forEach(btn => {
        btn.addEventListener('click', (e) => {
          const file = e.currentTarget.getAttribute('data-file');
          openDownloadModal(file);
        });
      });
    }

    // --- Ad rendering / fallback ---
    function renderAdIn(container, slotId) {
      try {
        const node = (typeof container === 'string') ? document.querySelector(container) : container;
        if (!node) return;
        node.innerHTML = '';
        // If AdSense available, inject ins element
        if (window.adsbygoogle && typeof window.adsbygoogle.push === 'function') {
          const ins = document.createElement('ins');
          ins.className = 'adsbygoogle';
          ins.style.display = 'block';
          ins.setAttribute('data-ad-client', (window.CONFIG && window.CONFIG.adsenseClientId) || 'ca-pub-6284022198338659');
          ins.setAttribute('data-ad-slot', String(slotId || '0'));
          ins.setAttribute('data-ad-format','auto');
          ins.setAttribute('data-full-width-responsive','true');
          node.appendChild(ins);
          try { (adsbygoogle = window.adsbygoogle || []).push({}); } catch(e){ /* ignore */ }
          return;
        }
        // Fallback content when ads blocked
        const fallback = document.createElement('div');
        fallback.className = 'ad-fallback';
        fallback.innerHTML = '<div><strong>Sponsored</strong><div style="margin-top:6px">Ad content is unavailable (adblocker or network). Click Start Ad to proceed.</div></div>';
        node.appendChild(fallback);
      } catch (err) {
        node && (node.innerHTML = '<div class="ad-fallback">Ad area unavailable</div>');
        console.warn('renderAdIn error', err);
      }
    }

    // Start simulated ad watching (progress) — disables re-start while running
    function startAdWatch(){
      if (adInterval) return; // already running
      adProgressValue = 0;
      updateProgressUI(0);
      startAdBtn.classList.add('btn-disabled');
      startAdBtn.setAttribute('disabled','true');

      // try loading a real ad into placeholder (slot id arbitrary)
      renderAdIn(adPlaceholder, 9525901183);

      let ticks = 0;
      adInterval = setInterval(() => {
        ticks++;
        const pct = Math.min(100, Math.round((ticks / ticksNeeded) * 100));
        adProgressValue = pct;
        updateProgressUI(pct);
        if (pct >= 100) {
          clearInterval(adInterval);
          adInterval = null;
          enableDownload();
        }
      }, adTickMs);
    }

    function updateProgressUI(pct){
      if (progressBar) progressBar.style.width = pct + '%';
      if (progressText) progressText.textContent = pct + '%';
    }

    function enableDownload(){
      if (!finalDownload) return;
      finalDownload.classList.remove('btn-disabled');
      finalDownload.removeAttribute('aria-disabled');
      finalDownload.removeAttribute('disabled');
      finalDownload.setAttribute('href', basePath + currentFile);
      finalDownload.setAttribute('download', currentFile);
      // visually ensure it's enabled
      finalDownload.style.pointerEvents = 'auto';
    }

    function resetModalState(){
      // stop any running simulation and reset UI
      if (adInterval) { clearInterval(adInterval); adInterval = null; }
      adProgressValue = 0;
      updateProgressUI(0);
      if (startAdBtn) { startAdBtn.classList.remove('btn-disabled'); startAdBtn.removeAttribute('disabled'); }
      if (finalDownload) { finalDownload.classList.add('btn-disabled'); finalDownload.removeAttribute('href'); finalDownload.setAttribute('aria-disabled','true'); finalDownload.style.pointerEvents='none'; }
      // restore placeholder message
      if (adPlaceholder) adPlaceholder.innerHTML = '<div class="ad-fallback">Ad area — will load if available</div>';
    }

    // Open modal for file
    function openDownloadModal(file){
      currentFile = file || '';
      resetModalState();
      if (downloadModal) downloadModal.style.display = 'flex';
      // focus start button for accessibility
      if (startAdBtn) startAdBtn.focus();
    }

    // Close modal
    function closeModal(){
      if (downloadModal) downloadModal.style.display = 'none';
      // cleanup
      resetModalState();
    }

    // Setup modal controls
    if (closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
    if (startAdBtn) startAdBtn.addEventListener('click', startAdWatch);
    if (finalDownload) {
      // prevent download click until enabled by enableDownload()
      finalDownload.addEventListener('click', function(e){
        if (finalDownload.classList.contains('btn-disabled')) {
          e.preventDefault();
          return false;
        } else {
          // close modal when starting download
          setTimeout(closeModal, 250);
        }
      });
      // initially disabled visually
      finalDownload.classList.add('btn-disabled');
      finalDownload.style.pointerEvents = 'none';
      finalDownload.setAttribute('aria-disabled','true');
    }

    // Close modal when clicking outside content
    window.addEventListener('click', function(ev){
      if (!downloadModal) return;
      if (ev.target === downloadModal) closeModal();
    });

    // Close on Esc
    window.addEventListener('keydown', function(e){
      if (e.key === 'Escape' || e.key === 'Esc') {
        closeModal();
      }
    });

    // Initial render
    renderList();

    // Provide a safe test helper from console if needed
    window.testOpenDownloadModal = function(file){ openDownloadModal(file || pdfFiles[0]); };

    // Load page ads within card areas (non-blocking)
    window.addEventListener('load', function(){ /* optional: load small ads in page areas if desired */ });

  })();
  </script>
</body>
</html>
